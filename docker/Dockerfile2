FROM centos
# FROM floydhub/dl-docker:cpu

RUN sed -i 's/mirrorlist/#mirrorlist/g' /etc/yum.repos.d/CentOS-*
RUN sed -i 's|#baseurl=http://mirror.centos.org|baseurl=http://vault.centos.org|g' /etc/yum.repos.d/CentOS-*
RUN yum update -y
RUN yum install -y wget mesa-libGL
RUN yum install -y gcc make openssl-devel bzip2-devel libffi-devel
RUN echo "alias python=python3.8" >> ~/.bashrc
RUN alias python=python3.8
RUN cat ~/.bashrc
# Install python38
# Install required packages


# Download Python 3.8 source code
RUN wget https://www.python.org/ftp/python/3.8.10/Python-3.8.10.tgz

# Extract and build Python 3.8
RUN tar -xzf Python-3.8.10.tgz \
    && cd Python-3.8.10 \
    && ./configure --enable-optimizations \
    && make -j $(nproc) \
    && make altinstall 

# Clean up
RUN cd .. \
    && rm -rf Python-3.8.10 Python-3.8.10.tgz

# Update alternatives to make Python 3.8 the default
RUN ln -sf /usr/local/bin/python3.8 /usr/bin/python
RUN python -V
RUN yum install -y epel-release
RUN yum install -y hdf5 hdf5-devel --skip-broken

# Create an user
ENV username=soumen
RUN useradd -m "$username"
RUN usermod -aG wheel "$username"
USER "$username"
# workdir
WORKDIR "/home/$username/oasis"
RUN chmod 777 "/home/$username/oasis"

# copy source
COPY train.py ./
COPY kaggle.json ./
COPY requirements.sh ./

# # install dependencies
RUN python3.8 -m venv ./myvenv
ENV PATH="./myvenv/bin:$PATH" 
# tensorflow_datasets torch
RUN sh requirements.sh

ENTRYPOINT ["bash"]